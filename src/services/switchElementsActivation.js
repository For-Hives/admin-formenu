import { getMenu } from '@/services/menu/getMenu'
import { toast } from 'react-toastify'

export async function toggleDishState(id, activated, session) {
	const res = await fetch(
		`${process.env.NEXT_PUBLIC_API_URL}/api/dishes/${id}`,
		{
			method: 'PUT',
			headers: {
				// 	token
				'Content-Type': 'application/json',
				Accept: 'application/json',
				Authorization: `Bearer ${session.jwt}`,
			},
			body: JSON.stringify({
				data: {
					activated: activated,
				},
			}),
		}
	)

	if (!res.ok) {
		toast('Une erreur est survenue, veuillez rÃ©essayer plus tard', {
			type: 'error',
			icon: 'â›”',
			toastId: 'toast-alert',
		})
	} else {
		toast('Plat modifiÃ© avec succÃ¨s', {
			type: 'success',
			icon: 'ðŸ‘Œ',
			toastId: 'toast-alert',
			position: 'top-left',
		})
	}
	return res.json()
}

export async function toggleAllergensState(
	id,
	name_property,
	activated,
	session
) {
	const res = await fetch(
		`${process.env.NEXT_PUBLIC_API_URL}/api/dishes/${id}`,
		{
			method: 'PUT',
			headers: {
				// 	token
				'Content-Type': 'application/json',
				Accept: 'application/json',
				Authorization: `Bearer ${session.jwt}`,
			},
			body: JSON.stringify({
				data: {
					[name_property]: activated,
				},
			}),
		}
	)

	if (!res.ok) {
		toast('Une erreur est survenue, veuillez rÃ©essayer plus tard', {
			type: 'error',
			icon: 'â›”',
			toastId: 'toast-alert',
		})
	} else {
		toast('AllergÃ¨ne modifiÃ© avec succÃ¨s', {
			type: 'success',
			icon: 'ðŸ‘Œ',
			toastId: 'toast-alert',
		})
	}
	return res.json()
}

export async function toggleIngredientState(
	id,
	activated,
	session,
	menuId,
	setStore
) {
	const res = await fetch(
		`${process.env.NEXT_PUBLIC_API_URL}/api/ingredients/${id}`,
		{
			method: 'PUT',
			headers: {
				// 	token
				'Content-Type': 'application/json',
				Accept: 'application/json',
				Authorization: `Bearer ${session.jwt}`,
			},
			body: JSON.stringify({
				data: {
					activated: activated,
				},
			}),
		}
	)

	if (!res.ok) {
		toast('Une erreur est survenue, veuillez rÃ©essayer plus tard', {
			type: 'error',
			icon: 'â›”',
			toastId: 'toast-alert',
		})
	} else {
		toast('IngrÃ©dient modifiÃ© avec succÃ¨s', {
			type: 'success',
			icon: 'ðŸ‘Œ',
			toastId: 'toast-alert',
		})
	}
	const newMenu = await getMenu(menuId, session)
	setStore(newMenu)
}

export async function toggleMenuState(id, activated, session) {
	const res = await fetch(
		`${process.env.NEXT_PUBLIC_API_URL}/api/menus/${id}`,
		{
			method: 'PUT',
			headers: {
				// 	token
				'Content-Type': 'application/json',
				Accept: 'application/json',
				Authorization: `Bearer ${session.jwt}`,
			},
			body: JSON.stringify({
				data: {
					activated: activated,
				},
			}),
		}
	)

	if (!res.ok) {
		toast('Une erreur est survenue, veuillez rÃ©essayer plus tard', {
			type: 'error',
			icon: 'â›”',
			toastId: 'toast-alert',
		})
	} else {
		toast('Menu modifiÃ© avec succÃ¨s', {
			type: 'success',
			icon: 'ðŸ‘Œ',
			toastId: 'toast-alert',
		})
	}
	return res.json()
}
